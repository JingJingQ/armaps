<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<title>Document</title>
	<script src="js/jquery3.2.1.min.js"></script>
	<script src="js/rem.js"></script>
    <style>
        body,html{
            width: 100%;
            height: 100%;
        }
        /*.box{
            width: 100%;
            height: 9rem;
            border: 0.01rem solid #000;
            margin: 0.02rem auto;
        }
        .box video{
            width: 100%;
            height: 100%;
        }*/
        canvas{
            width: 100%;
            height: 9rem;
        }
    </style>
</head>
<body>
    <input type="button" title="开启摄像头" value="开启摄像头" onclick="getMedia();" /><br/> 
    <div class="box">
        <video autoplay="autoplay"></video>
    </div> 
    <canvas></canvas>
</body>
</html>
<script>
    var video = document.querySelector('video'); 
    var canvas=document.querySelector("canvas");
    //设置字体样式
    ctx.font = "30px Courier New";
    //设置字体填充颜色
    ctx.fillStyle = "blue";
    //从坐标点(50,50)开始绘制文字
    ctx.fillText("公园", 50, 50);
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;  
        window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;  
  
        var exArray = []; //存储设备源ID  
        MediaStreamTrack.getConstraints(function (sourceInfos) {  
            for (var i = 0; i != sourceInfos.length; ++i) {  
                var sourceInfo = sourceInfos[i];  
                //这里会遍历audio,video，所以要加以区分  
                if (sourceInfo.kind === 'video') {  
                    exArray.push(sourceInfo.id);  
                }  
            }  
        });  
  
        function getMedia() {  
            if (navigator.getUserMedia) {  
                navigator.getUserMedia({  
                    'video': {  
                        'optional': [{  
                            'sourceId': exArray[1] //0为前置摄像头，1为后置  
                        }]  
                    
                    },  
                    'audio':true  
                }, successFunc, errorFunc);    //success是获取成功的回调函数  
            }  
            else {  
                alert('Native device media streaming (getUserMedia) not supported in this browser.');  
            }  
        }  
        function successFunc(stream) {  
            //alert('Succeed to get media!');  
            if (video.mozSrcObject !== undefined) {  
                //Firefox中，video.mozSrcObject最初为null，而不是未定义的，我们可以靠这个来检测Firefox的支持  
                video.mozSrcObject = stream;  
            }  
            else {  
                video.src = window.URL && window.URL.createObjectURL(stream) || stream; 
                var context = canvas.getContext("2d");
                 drawVideoAtCanvas(video,context); 
            }  
  
            //video.play();  
  
            // 音频  
            audio = new Audio();  
            audioType = getAudioType(audio);  
            if (audioType) {  
                audio.src = 'polaroid.' + audioType;  
                audio.play();  
            }  
        }  
        function errorFunc(e) {  
            alert('Error！'+e);  
        }  
  
          
        // 将视频帧绘制到Canvas对象上,Canvas每60ms切换帧，形成肉眼视频效果  
        function drawVideoAtCanvas(video,context) {  
            window.setInterval(function () {  
                context.drawImage(video, 0, 0,90,120);  
            }, 60);  
        }  
  
        //获取音频格式  wEwOE1p1eXOiagi88LenfO2GBA7491tN
        // function getAudioType(element) {  
        //     if (element.canPlayType) {  
        //         if (element.canPlayType('audio/mp4; codecs="mp4a.40.5"') !== '') {  
        //             return ('aac');  
        //         } else if (element.canPlayType('audio/ogg; codecs="vorbis"') !== '') {  
        //             return ("ogg");  
        //         }  
        //     }  
        //     return false;  
        // }  
  
</script>